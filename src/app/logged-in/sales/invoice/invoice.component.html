<div class="card">
  <div class="card-body">
          <!-- Content Header (Page header) -->
          <section class="content-header">
            <h3>
                <span *ngIf="salesInfo.order_collect == 0">Profoma Invoice</span>
                <span *ngIf="salesInfo.order_collect == 1">Supply Ticket</span>
                <span *ngIf="salesInfo.order_collect > 1">Invoice</span> 
         
              <small>  #{{salesInfo.salesid}}</small>
            </h3>
          </section>

          <!-- Main content -->
          <section class="invoice">
            <!-- title row -->
            <div class="row mt-3">
              <div class="col-lg-6">
                <h4><i class="fa fa-globe"></i> {{salesInfo.name}}</h4>
                <p><span class="text-white btn btn-round {{salesInfo.order_color}}">
                  {{salesInfo.ordercollectstage}}
                </span></p>
              </div>
    <div class="col-lg-6">
      <a routerLink="/access/sales/edit-sales/{{salesInfo.id}}"  *ngIf="salesInfo.order_collect == 0 && salesInfo.createdBy == userid" class="float-sm-right btn btn-round btn-info">EDIT INVOICE</a>
     <h5 class="float-sm-right">Date Generated: {{salesInfo.createdDate | date:'EEEE, MMM, dd, yyyy'}}<br/>
     <span *ngIf="salesInfo.order_collect > 0">Date Closed: {{salesInfo.order_collect_date | date:'EEEE, MMM, dd, yyyy'}}</span></h5>
   
    </div>
            </div>
  
            <hr>
            <div id="contentToConvert">
                <div class="row invoice-info">
                  <div class="col-sm-6 invoice-col">
                    From
                    <address>
                    <strong>CIS BURO LTD.</strong><br>
                    13 Palace Road Oniru Estate,<br/> Victoria Island Extension<br/> Lagos, Nigeria<br/>
                      Phone: 08093450000, 08187124805, 08187124804<br>
                      Email: info@cisburoltd.com
                    </address>
                  </div><!-- /.col -->
                  <div class="col-sm-6 invoice-col" style="text-align:right">
                    To
                    <address>
                      <strong>{{salesInfo.name}}</strong><br>
                      {{salesInfo.address}}<br>
                      <!-- Boston, MA 94107<br> -->
                      Phone: {{salesInfo.phone}}<br>
                      Email: {{salesInfo.email}}<br/>
                      <b>
                        <span *ngIf="salesInfo.order_collect == 0">Profoma Invoice</span>
                        <span *ngIf="salesInfo.order_collect == 1">Supply Ticket</span>
                        <span *ngIf="salesInfo.order_collect > 1">Invoice</span> #{{salesInfo.salesid}}</b><br>
                      <b>Order ID:</b> {{salesInfo.ticketNo}}<br>
                    </address>
                  </div><!-- /.col -->
                
                </div><!-- /.row -->

                <!-- Table row -->
                <div class="row">
                  <div class="col-12 table-responsive">
                    <table class="table table-sm table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>#</th>                     
                          <th>Product</th>
                          <th>Code</th>
                          <th>Unit Price</th>
                          <th>Qty</th>
                          <th>Subtotal</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let c of salesDetails,let i=index">
                          <td>{{i+1}}.</td>                  
                          <td>{{c.productName}}</td>
                          <td>{{c.code}}</td>
                          <td>{{utils.getCurrency()}}{{c.amount | number:'.2'}}</td>
                          <td>{{c.qty}}</td>
                          <td>{{utils.getCurrency()}}{{c.total | number:'.2'}}</td>
                        
                        </tr>
                        <tr>
                            <td colspan="5"><b><p style="text-align:right">Discount :</p></b> </td>
                            <td> <p style="color:red"> - {{utils.getCurrency()}}{{salesInfo.discount  | number:'.2'}}</p></td>
                        </tr>
                        <tr>
                          <td colspan="5"><b><p style="text-align:right">Sub Total :</p></b> </td>
                          <td>{{utils.getCurrency()}}{{(salesInfo.TotalPrice - salesInfo.discount)  | number:'.2'}}</td>
                        </tr>
                        
                          <tr>
                              <td colspan="5"><b><p style="text-align:right">VAT :</p></b> </td>
                              <td>{{utils.getCurrency()}}{{vat  | number:'.2'}}</td>
                          </tr>

                          <tr>
                              <td colspan="5"><b><p style="text-align:right">Total Amount :</p></b> </td>
                              <td>{{utils.getCurrency()}}{{finalTotal  | number:'.2'}}</td>
                          </tr>

                          <tr>
                            <td colspan="6">
                              <p style="text-align: center">
                              {{utils.numberToWord(finalTotal)}} {{utils.CurrencyName()}} Only
                              </p>
                            </td>
                          </tr>

                          <tr>
                              <td colspan="5"><b><p style="text-align:right">Amount Paid :</p></b> </td>
                              <td>{{utils.getCurrency()}}{{salesInfo.AmountCurrentlyPaid  | number:'.2'}}</td>
                          </tr>

                          <tr>
                              <td colspan="5"><b><p style="text-align:right;color:red">Amount Owing :</p></b> </td>
                              <td style="color: red">{{utils.getCurrency()}}{{this.amountOwing  | number:'.2'}}</td>
                          </tr>
                      
                      </tbody>
                    </table>
                  </div><!-- /.col -->
                </div><!-- /.row -->
            </div>
            
            <!-- this row will not appear when printing -->
            <hr>
            <div class="row no-print">
              <div class="col-lg-6">
                 <a target="_blank"
                 data-toggle="modal"  data-target="#closeorder" 
                 class="text-white btn btn-dark m-1" 
                 *ngIf="salesInfo.order_collect == 0 && salesInfo.createdBy == userid">
                 <i class="fa fa-print"></i> Close Order</a> 
                <!-- <a routerLink="/access/delivery/"  target="_blank" *ngIf="salesInfo.order_collect > 0" class="btn btn-secondary m-1">
                  <i class="fa fa-truck"></i> Generate Delivery Note</a> -->
             </div>
    <div class="col-lg-6">
    <div class="float-sm-right">
                 <button class="btn btn-success m-1" data-target="#collectpayment"
                 *ngIf="amountOwing > 0 && ((roleId == 1) || (departmentId == 7))"
                 data-toggle="modal" >
                 <i class="fa fa-credit-card"></i> Submit Payment
                </button>
                 <!-- <button class="btn btn-primary m-1" (click)="captureScreen()"><i class="fa fa-download"></i> Generate PDF</button> -->
                 <a class="btn btn-primary m-1" 
                 routerLink="/ticket/invoice/{{salesInfo?.id}}"
                 target="_blank"
                 ><i class="fa fa-download"></i> Printable</a>
    </div>
              </div>
            </div>


            <div class="row">
              <!-- accepted payments column -->
              <div class="col-lg-12 payment-icons"><br/><br/>
                <p class="lead">Payment Break down:</p>
              
                <p class="bg-light p-2 mt-3 rounded">
                
                </p>



                <div class="table-responsive">
                  <table class="table">
                    <tbody>
                      <tr>
                        <th>Collected By</th>
                        <th>Payment Mode</th>
                        <th>Date Collected</th>
                        <th>Amount</th>
                        <th>Note</th>
                      </tr>
                        <tr *ngFor="let c of paymentHistory">
                            <td>{{c.Admin}}</td>
                            <td>{{c.paymentmode}}</td>
                            <td>{{c.collectedDate | date:'EEEE, MMM, dd, yyyy'}}</td>
                            <td>{{utils.getCurrency()}}{{c.amount | number:'.2'}}</td>
                            <td>{{c.note}}</td>
                          </tr>
                        
                  </tbody>
      </table>
                </div>


             
              </div><!-- /.col -->



              <div class="col-lg-12 payment-icons"><br/><br/>
                <p class="lead">Delivery Note:</p>
              
                <p class="bg-light p-2 mt-3 rounded">
                
                </p>



                <div class="table-responsive">
                  <table class="table">
                    <tbody>
                      <tr>
                        <th>Delivery Option</th>
                        <th>Delivery Status</th>
                        <th>Date Created</th>
                        <th>Delivery Address</th>
                        <th></th>
                      </tr>
                        <tr *ngFor="let c of deliveryNote">
                            <td>{{c.delivery_option}}</td>
                            <td>{{c.delivery_status}}</td>
                            <td>{{c.createdDate | date:'EEEE, MMM, dd, yyyy'}}</td>
                            <td>{{c.delivery_address}}</td>
                            <td><a  routerLink="/ticket/delivery-note/{{c?.id}}/{{salesInfo.id}}"
                              target="_blank"
              class="btn btn-success">view</a> &nbsp;&nbsp;
              <!-- <a href="" class="btn btn-warning">update</a> -->
            </td>
                          </tr>
                        
                  </tbody>
      </table>
                </div>


             
              </div><!-- /.col -->
           



            </div><!-- /.row -->
 
          </section><!-- /.content -->
  </div>
</div>




<div class="modal fade" id="closeorder">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Collect Order</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="formcloseorder" (ngSubmit)="submitcloseorder()">
          <div class="form-group row">
                  <label for="input-21" class="col-sm-2 col-form-label">Date Closed</label>
                  <div class="input-group mb-3">
                    <input [owlDateTime]="dt1" formControlName ="date" readonly
                        [ngClass]="{ 'is-invalid': submitted && f.date.errors }"
                          class="form-control" [min]="2/24/2019"
                        [owlDateTimeTrigger]="dt1" placeholder="Date Time">
                      <div class="input-group-append">
                      <span class="input-group-text"><i class="fa fa-times-rectangle"></i></span>
                    </div>
                  </div>
                  <owl-date-time #dt1 ></owl-date-time>
                  <div *ngIf="submitted && f.date.errors" class="invalid-feedback">
                    <div *ngIf="f.date.errors.required">this field is required</div>        
                </div>
         </div>

         <div class="form-group">
           <button class="btn btn-success">Collect Order</button>
         </div>
          </form>
          
      </div>
    
   

    </div>
  </div>
</div>




<div class="modal fade" id="collectpayment">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Collect Payment</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
         <!-- <div [innerHTML] = "storyInformation" style="text-align:center"></div> -->
        <div class="modal-body">
          <h3 style="text-align: center">AMOUNT YET TO BE PAID</h3>
          <h1 style="text-align: center">{{utils.getCurrency()}}{{amountOwing | number:'.2'}}</h1>
          <form [formGroup]="collectmoney" (ngSubmit)="submitcollectmoney()">
            <div class="form-group row">
                    <label for="input-21" class="col-sm-12 col-form-label">Date Collected</label>
                    <div class="input-group mb-3">
                       <input [owlDateTime]="dt3" formControlName ="date" readonly
                          [ngClass]="{ 'is-invalid': submitted && f2.date.errors }"
                            class="form-control" [min]="2/24/2019"
                          [owlDateTimeTrigger]="dt3" placeholder="Date Time"> 
                        <div class="input-group-append">
                        <span class="input-group-text"><i class="fa fa-times-rectangle"></i></span>
                      </div>
                    </div>
                    <owl-date-time #dt3 ></owl-date-time>
                    <div *ngIf="submitted && f2.date.errors" class="invalid-feedback">
                      <div *ngIf="f2.date.errors.required">this field is required</div>        
                  </div>
           </div>

           <div class="form-group row">
                      <label for="input-21" class="col-sm-12 col-form-label">Amount Collected</label>
                      <div class="input-group mb-3">
                        <input type="text" class="form-control" formControlName="amount"
                        (keypress)="utils.decimalsOnly($event,f2.amount)"
                            [ngClass]="{ 'is-invalid': submitted && f2.amount.errors }"
                            placeholder="Amount Collected"> 
                        
                      </div>
                     
                      <div *ngIf="submitted && f2.amount.errors" class="invalid-feedback">
                        <div *ngIf="f2.amount.errors.required">this field is required</div>        
                    </div>
          </div>

          <div class="form-group row">
              <label for="input-21" class="col-sm-12 col-form-label">Payment Mode</label>
              <div class="input-group mb-3">
                <select class="form-control" formControlName="paymentmode"
               
                    [ngClass]="{ 'is-invalid': submitted && f2.paymentmode.errors }"
                    placeholder="Payment Mode"> 
                 
                            <option>BANK DEPOSIT</option>
                            <option>BANK TRANSFER</option>
                            <option>CASH</option>
                            <option>CHEQUE</option>
              
                  </select>
                
              </div>
             
              <div *ngIf="submitted && f2.paymentmode.errors" class="invalid-feedback">
                <div *ngIf="f2.paymentmode.errors.required">this field is required</div>        
            </div>
  </div>
   <div class="form-group row">
    <label for="input-21" class="col-sm-12 col-form-label">Note</label>
    <div class="input-group mb-3">
      
           <textarea class="form-control" formControlName ="note"
           [ngClass]="{ 'is-invalid': submitted && f2.amount.errors }"></textarea>
       
    </div>
   
    <div *ngIf="submitted && f2.note.errors" class="invalid-feedback">
      <div *ngIf="f2.note.errors.required">this field is required</div>        
  </div>
</div>



           <div class="form-group">
             <button class="btn btn-success">Collect Money</button>
           </div>
            </form>
            
        </div>
      
     
  
      </div>
    </div>
  </div>